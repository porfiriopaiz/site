<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>porfirio's blog - linux</title><link>https://porfiriopaiz.github.io/site/</link><description/><atom:link href="https://porfiriopaiz.github.io/site/feeds/linux.rss.xml" rel="self"/><lastBuildDate>Sun, 01 Feb 2026 15:00:00 -0600</lastBuildDate><item><title>Keeping Your APT Package Cache Persistent</title><link>https://porfiriopaiz.github.io/site/posts/2026/02/01/keep-apt-cache.html</link><description>&lt;p&gt;If &lt;tt class="docutils literal"&gt;/var/cache/apt/archives&lt;/tt&gt; is empty, it usually means your system is
configured to clean up automatically to save disk space. While this keeps the
system lean, it’s frustrating if you wanted to keep those .deb files for
backups or offline installs.&lt;/p&gt;
&lt;p&gt;Here is how to find the culprit and fix it.&lt;/p&gt;
&lt;hr class="docutils" /&gt;
&lt;div class="section" id="check-the-keep-downloaded-packages-setting"&gt;
&lt;h2&gt;Check the &amp;quot;Keep-Downloaded-Packages&amp;quot; Setting&lt;/h2&gt;
&lt;p&gt;Modern Debian/Ubuntu systems often have a specific configuration that deletes
packages immediately after installation. You need to ensure this is set to
&lt;tt class="docutils literal"&gt;true&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Create or edit a configuration file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;nano&lt;span class="w"&gt; &lt;/span&gt;/etc/apt/apt.conf.d/01keep-debs
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Add this exact line to the file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Binary::apt::APT::Keep-Downloaded-Packages &amp;quot;true&amp;quot;;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;If this is set to &lt;tt class="docutils literal"&gt;false&lt;/tt&gt; (or &lt;tt class="docutils literal"&gt;0&lt;/tt&gt;), APT deletes the files as soon as the
installation finishes.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;hr class="docutils" /&gt;
&lt;div class="section" id="disable-periodic-cleaning"&gt;
&lt;h2&gt;Disable Periodic Cleaning&lt;/h2&gt;
&lt;p&gt;Debian has a background script called &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;apt-daily&lt;/span&gt;&lt;/tt&gt; that cleans the cache.
Even if you tell APT to keep files, the daily maintenance script might be
sweeping them away.&lt;/p&gt;
&lt;div class="section" id="check-your-periodic-settings"&gt;
&lt;h3&gt;Check Your Periodic Settings&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat&lt;span class="w"&gt; &lt;/span&gt;/etc/apt/apt.conf.d/10periodic
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Look for these lines and change them to &lt;tt class="docutils literal"&gt;0&lt;/tt&gt; to disable them:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;APT::Periodic::MaxAge&lt;/span&gt; &amp;quot;0&amp;quot;;&lt;/tt&gt;: Prevents deleting files based on age.&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;APT::Periodic::MaxSize&lt;/span&gt; &amp;quot;0&amp;quot;;&lt;/tt&gt;: Prevents deleting files based on folder size.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;hr class="docutils" /&gt;
&lt;div class="section" id="check-for-no-cache-configuration"&gt;
&lt;h2&gt;Check for &amp;quot;No-Cache&amp;quot; Configuration&lt;/h2&gt;
&lt;p&gt;Some cloud-images or &amp;quot;minimal&amp;quot; installs include a file that redirects the
cache to &lt;tt class="docutils literal"&gt;/dev/null&lt;/tt&gt;.&lt;/p&gt;
&lt;div class="section" id="identify-problematic-files"&gt;
&lt;h3&gt;Identify Problematic Files&lt;/h3&gt;
&lt;p&gt;Check if you have a file named &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;/etc/apt/apt.conf.d/docker-clean&lt;/span&gt;&lt;/tt&gt; (even if
you aren't in a Docker container) or similar. If you see a line like this,
delete the file or comment the line out:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Dir::Cache::Archives &amp;quot;/dev/null&amp;quot;;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;hr class="docutils" /&gt;
&lt;div class="section" id="verify-directory-permissions"&gt;
&lt;h2&gt;Verify Directory Permissions&lt;/h2&gt;
&lt;p&gt;If the directory permissions are incorrect, APT cannot write the files there.
Ensure the directory is owned by &lt;strong&gt;root&lt;/strong&gt; but accessible to the &lt;strong&gt;_apt&lt;/strong&gt; user.&lt;/p&gt;
&lt;p&gt;Run the following to reset permissions:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;chown&lt;span class="w"&gt; &lt;/span&gt;root:root&lt;span class="w"&gt; &lt;/span&gt;/var/cache/apt/archives
sudo&lt;span class="w"&gt; &lt;/span&gt;chmod&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;755&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;/var/cache/apt/archives
sudo&lt;span class="w"&gt; &lt;/span&gt;mkdir&lt;span class="w"&gt; &lt;/span&gt;-p&lt;span class="w"&gt; &lt;/span&gt;/var/cache/apt/archives/partial
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;hr class="docutils" /&gt;
&lt;div class="section" id="summary-of-the-apt-cache-path"&gt;
&lt;h2&gt;Summary of the APT Cache Path&lt;/h2&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="46%" /&gt;
&lt;col width="54%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Folder&lt;/th&gt;
&lt;th class="head"&gt;Purpose&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;/var/cache/apt/archives&lt;/td&gt;
&lt;td&gt;Where completed .deb downloads are
stored.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;/var/cache/apt/archives/partial&lt;/td&gt;
&lt;td&gt;Where files sit during the download
process.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;hr class="docutils" /&gt;
&lt;div class="section" id="how-to-test-your-changes"&gt;
&lt;h2&gt;How to Test Your Changes&lt;/h2&gt;
&lt;p&gt;After making these changes, try downloading a package without installing it
to verify the cache is working:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;apt&lt;span class="w"&gt; &lt;/span&gt;update
sudo&lt;span class="w"&gt; &lt;/span&gt;apt&lt;span class="w"&gt; &lt;/span&gt;install&lt;span class="w"&gt; &lt;/span&gt;--download-only&lt;span class="w"&gt; &lt;/span&gt;wget
ls&lt;span class="w"&gt; &lt;/span&gt;/var/cache/apt/archives&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;wget
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By following these steps, you can ensure that your system maintains a local
archive of your packages, making future reinstalls or offline updates much
easier!&lt;/p&gt;
&lt;/div&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Porfirio Páiz</dc:creator><pubDate>Sun, 01 Feb 2026 15:00:00 -0600</pubDate><guid>tag:porfiriopaiz.github.io,2026-02-01:/site/posts/2026/02/01/keep-apt-cache.html</guid><category>floss</category><category>debian</category><category>apt</category><category>linux</category><category>bash</category></item></channel></rss>